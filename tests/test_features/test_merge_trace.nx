// Trace merge with 2 linked lists

struct Node 
    data: int,
    next: ref Node
end

let n1: Node = Node(1, null)
let n2: Node = Node(2, null)
let n3: Node = Node(3, null)
let n4: Node = Node(4, null)

n1.next = n3
n2.next = n4

func merge(l1: ref Node, l2: ref Node, depth: int) -> ref Node
    print("merge depth=" + to_str(depth) + " l1=" + to_str(l1.data) + " l2=" + to_str(l2.data))
    
    if l1 == null then
        print("  returning l2 (l1 null)")
        return l2
    end
    if l2 == null then
        print("  returning l1 (l2 null)")
        return l1
    end
    
    if l1.data < l2.data then
        print("  l1 < l2, recursing with l1.next")
        let result: ref Node = merge(l1.next, l2, depth + 1)
        print("  back at depth=" + to_str(depth) + ", setting l1.next")
        l1.next = result
        print("  returning l1")
        return l1
    else
        print("  l2 <= l1, recursing with l2.next")
        let result: ref Node = merge(l1, l2.next, depth + 1)
        print("  back at depth=" + to_str(depth) + ", setting l2.next")
        l2.next = result
        print("  returning l2")
        return l2
    end
end

print("Calling merge:")
let result: ref Node = merge(n1, n2, 0)
print("Merge complete!")
print("Result data: " + to_str(result.data))
