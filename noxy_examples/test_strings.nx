// test_strings.nx - Robust version
use strings select *

func pass(name: string) -> void
    print("PASS: " + name)
end

func fail(name: string) -> void
    print("FAIL: " + name)
end

print("=== STRINGS TEST ===")

// 1. Search
let txt: string = "Hello, World!"

if contains(txt, "World") then pass("contains") else fail("contains") end
if starts_with(txt, "Hello") then pass("starts_with") else fail("starts_with") end
if ends_with(txt, "!") then pass("ends_with") else fail("ends_with") end

let idx: int = index_of(txt, ",")
if idx == 5 then pass("index_of") else fail("index_of") end

let cnt: int = count("abracadabra", "a")
if cnt == 5 then pass("count") else fail("count") end

// 2. Transform
// to_upper
if to_upper("hello") == "HELLO" then pass("to_upper") else fail("to_upper") end
// to_lower
if to_lower("WORLD") == "world" then pass("to_lower") else fail("to_lower") end
// trim
if trim("  abc  ") == "abc" then pass("trim") else fail("trim") end
// reverse
if reverse("abc") == "cba" then pass("reverse") else fail("reverse") end
// repeat
if repeat("ab", 2) == "abab" then pass("repeat") else fail("repeat") end

// 3. Manip
// substring
if substring("Hello", 0, 2) == "He" then pass("substring") else fail("substring") end
// replace
if replace("aaa", "a", "b") == "bbb" then pass("replace") else fail("replace") end
// replace_first
if replace_first("aaa", "a", "b") == "baa" then pass("replace_first") else fail("replace_first") end
// pad_left
if pad_left("42", 3, "0") == "042" then pass("pad_left") else fail("pad_left") end

// 4. Split/Join
let res: SplitResult = split("a,b", ",")
if res.count == 2 then
    if res.parts[0] == "a" then
        pass("split")
    else
        fail("split val")
    end
else
    fail("split count")
end

let joined: string = join_count(res.parts, "-", res.count)
if joined == "a-b" then pass("join_count") else fail("join_count") end

// 5. Char Checks
if is_empty("") then pass("is_empty") else fail("is_empty") end
if is_digit("123") then pass("is_digit") else fail("is_digit") end
if is_alpha("abc") then pass("is_alpha") else fail("is_alpha") end
if is_alnum("a1") then pass("is_alnum") else fail("is_alnum") end
if is_space(" ") then pass("is_space") else fail("is_space") end

// 6. Conversions
let ch: string = char_at("Hi", 1)
if ch == "i" then pass("char_at") else fail("char_at") end

let fc: string = from_char_code(65)
if fc == "A" then pass("from_char_code") else fail("from_char_code") end

print("=== DONE ===")
